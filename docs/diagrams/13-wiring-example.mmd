flowchart TB
    subgraph MainApp[main.rs Application Wiring]
        direction TB
        
        subgraph TypeDef[Type Definitions]
            T1[type ProdTiers = MultiTier&lt;<br/>L0InProc,<br/>L1Redis,<br/>L2Mid,<br/>DurableTier&lt;S3Blob, DdbIndex&gt;<br/>&gt;]
            
            T2[type DevTiers = MultiTier&lt;<br/>L0InProc,<br/>L1Redis,<br/>L2Mid,<br/>DurableTier&lt;MinIOBlob, RedisIndex&gt;<br/>&gt;]
            
            T3[type GlobalTiers = MultiTier&lt;<br/>L0InProc,<br/>L1Redis,<br/>L2Mid,<br/>DurableTier&lt;S3Blob, CrdbIndex&gt;<br/>&gt;]
        end
        
        subgraph Init[Static Initialization]
            I1[static L3_PROD: Lazy&lt;&'static DurableTier&lt;S3Blob, DdbIndex&gt;&gt;]
            I2[L3_PROD = DurableTier::new<br/>blob: Box::leak S3Blob<br/>index: Box::leak DdbIndex]
            
            I3[static TIERS: Lazy&lt;&'static ProdTiers&gt;]
            I4[TIERS = MultiTier::new<br/>l0: Some L0InProc<br/>l1: Some L1Redis<br/>l2: None<br/>l3: L3_PROD<br/>policy: Policy::default]
            
            I1 --> I2
            I3 --> I4
            I4 --> I2
        end
        
        subgraph Runtime[Pingora Request Handler]
            R1[fn request_cache_filter]
            R2[session.cache.enable<br/>TIERS as &'static dyn Storage + Sync]
            
            R1 --> R2
            R2 --> I3
        end
    end
    
    subgraph CompileTime[Compile-Time Guarantees]
        C1[✓ All types statically known<br/>No dynamic dispatch overhead]
        C2[✓ Zero-cost abstractions<br/>Traits compile to direct calls]
        C3[✓ Type safety<br/>Cannot mix incompatible impls]
    end
    
    subgraph FeatureFlags[Cargo Feature Flags]
        F1[backend-aws<br/>• aws-sdk-s3<br/>• aws-sdk-dynamodb]
        F2[backend-crdb<br/>• sqlx/postgres<br/>• CockroachDB driver]
        F3[backend-minio<br/>• aws-sdk-s3<br/>with custom endpoint]
        F4[backend-redis<br/>• redis crate]
    end
    
    subgraph Swap[Hot Swapping at Compile Time]
        direction LR
        Code[Same Application Code]
        
        subgraph Choose[Choose Backend]
            Cargo1[Cargo.toml:<br/>features = backend-aws]
            Cargo2[Cargo.toml:<br/>features = backend-crdb]
            Cargo3[Cargo.toml:<br/>features = backend-minio]
        end
        
        Result[Different Binary<br/>Same Interface]
        
        Code --> Choose
        Choose --> Result
    end
    
    style T1 fill:#90EE90
    style T2 fill:#87CEEB
    style T3 fill:#DDA0DD
    style I2 fill:#F08080
    style I4 fill:#FFD700
    style R2 fill:#FFD700
    style Code fill:#90EE90
    style Result fill:#90EE90
