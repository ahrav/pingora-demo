sequenceDiagram
    participant Client
    participant Pingora
    participant L0
    participant L1
    participant L2
    participant L3
    participant Origin
    
    Note over Client,Origin: Scenario: Cold cache (MISS all tiers)
    
    Client->>Pingora: GET /image.jpg
    activate Pingora
    
    Pingora->>L0: lookup(key)
    L0-->>Pingora: None (miss)
    
    Pingora->>L1: lookup(key)
    L1-->>Pingora: None (miss)
    
    Pingora->>L2: lookup(key)
    L2-->>Pingora: None (miss)
    
    Pingora->>L3: lookup(key)
    L3-->>Pingora: None (miss)
    
    Pingora->>Origin: GET /image.jpg
    activate Origin
    
    Note over Pingora: Create FanoutMiss handler<br/>Check gates: 1.5MB file<br/>L0: ✓ (≤2MB)<br/>L1: ✓ (≤64MB)<br/>L2: ✓<br/>L3: ✓ (DurableTier)
    
    loop Stream response
        Origin-->>Pingora: chunk
        
        par Fanout write to all tiers
            Pingora->>L0: write_body(chunk)
            L0-->>Pingora: ok
        and
            Pingora->>L1: write_body(chunk)
            L1-->>Pingora: ok
        and
            Pingora->>L2: write_body(chunk)
            L2-->>Pingora: ok
        and
            Pingora->>L3: write_body(chunk)
            L3-->>Pingora: ok
        end
        
        Pingora-->>Client: chunk
    end
    
    deactivate Origin
    
    par Finish all tiers
        Pingora->>L0: finish()
        L0-->>Pingora: Success
    and
        Pingora->>L1: finish()
        L1-->>Pingora: Success
    and
        Pingora->>L2: finish()
        L2-->>Pingora: Success
    and
        Pingora->>L3: finish()
        L3-->>Pingora: Success
    end
    
    Pingora-->>Client: complete
    deactivate Pingora
