flowchart TB
    Client[HTTP Client]
    
    subgraph Pingora[Pingora Reverse Proxy]
        ProxyLogic[ProxyHttp Logic<br/>request_cache_filter]
        CacheSession[Session Cache]
    end
    
    subgraph MultiTierLogic[MultiTier&lt;L0, L1, L2, L3&gt; Storage]
        direction TB
        Lookup[lookup method<br/>OR semantics: L0 → L1 → L2 → L3]
        GetMiss[get_miss_handler<br/>FanoutMiss with byte gates]
        
        subgraph Tiers[Tier Cascade]
            TL0[L0: In-Process<br/>MemoryCache/TinyLFU]
            TL1[L1: Distributed<br/>Redis/Memcached]
            TL2[L2: Mid-Tier<br/>Optional layer]
            TL3[L3: DurableTier&lt;B, I&gt;]
        end
    end
    
    subgraph L3Detail[L3: DurableTier Implementation]
        direction TB
        L3Lookup[lookup<br/>Index → Blob]
        L3Miss[get_miss_handler<br/>BlobMiss]
        
        subgraph Traits[Pluggable Traits]
            BlobTrait[BlobStore Trait]
            IndexTrait[IndexStore Trait]
        end
        
        subgraph Impls[Concrete Implementations]
            direction LR
            BlobImpl[S3 / MinIO / Ceph / Local]
            IndexImpl[DynamoDB / CockroachDB / Redis]
        end
        
        L3Lookup --> IndexTrait
        L3Lookup --> BlobTrait
        L3Miss --> BlobTrait
        L3Miss --> IndexTrait
        
        BlobTrait -.-> BlobImpl
        IndexTrait -.-> IndexImpl
    end
    
    Origin[Origin Server]
    
    Client -->|1. HTTP Request| ProxyLogic
    ProxyLogic -->|2. Enable cache| CacheSession
    CacheSession -->|3. lookup| Lookup
    
    Lookup -->|Try L0| TL0
    TL0 -.->|Miss| TL1
    TL1 -.->|Miss| TL2
    TL2 -.->|Miss| TL3
    
    TL3 -->|Delegate| L3Lookup
    L3Lookup -->|IndexStore.get| IndexImpl
    L3Lookup -->|BlobStore.get| BlobImpl
    
    TL3 -.->|Miss| Origin
    Origin -->|Response| CacheSession
    
    CacheSession -->|4. get_miss_handler| GetMiss
    GetMiss -->|Fanout| TL0
    GetMiss -->|Fanout| TL1
    GetMiss -->|Fanout| TL2
    GetMiss -->|Fanout| TL3
    
    TL3 -->|Delegate| L3Miss
    L3Miss -->|BlobStore.put| BlobImpl
    L3Miss -->|IndexStore.put_new| IndexImpl
    
    CacheSession -->|5. Stream response| Client
    
    subgraph Promotions[Automatic Promotions on Hit]
        P1[L3 → L2: Async]
        P2[L3 → L1: Async]
        P3[L3 → L0: Sync]
        P4[L2 → L1: Async]
        P5[L2 → L0: Sync]
        P6[L1 → L0: Sync]
    end
    
    TL3 -.->|Policy-driven| P1
    TL3 -.->|Policy-driven| P2
    TL3 -.->|Policy-driven| P3
    TL2 -.->|Policy-driven| P4
    TL2 -.->|Policy-driven| P5
    TL1 -.->|Policy-driven| P6
    
    style Client fill:#FFD700
    style ProxyLogic fill:#FFD700
    style TL0 fill:#90EE90
    style TL1 fill:#87CEEB
    style TL2 fill:#DDA0DD
    style TL3 fill:#F08080
    style BlobImpl fill:#FFB6C6
    style IndexImpl fill:#DDA0DD
    style Origin fill:#FFE4B5
    style BlobTrait fill:#87CEEB
    style IndexTrait fill:#87CEEB
