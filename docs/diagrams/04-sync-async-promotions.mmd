sequenceDiagram
    participant Client
    participant HitWrapper
    participant Source as Source Tier<br/>(L2/L3)
    participant L0 as L0 Sync
    participant L1 as L1 Async<br/>Worker
    
    Note over Client,L1: L2 or L3 HIT scenario
    
    Client->>HitWrapper: read_body()
    activate HitWrapper
    
    HitWrapper->>Source: read_body()
    activate Source
    Source-->>HitWrapper: chunk
    deactivate Source
    
    par Sync L0 Promotion
        HitWrapper->>L0: write_body(chunk)
        Note over L0: Blocking write<br/>but fast (in-proc)
        L0-->>HitWrapper: ok
    and Client path
        HitWrapper-->>Client: chunk
        Note over Client: TTFB unaffected<br/>by L1/L2 promotions
    and Async L1 Promotion
        HitWrapper->>L1: tx.try_send(chunk)
        Note over L1: Non-blocking send<br/>drop if channel full
        
        Note over L1: Worker spawned<br/>lazily on first chunk
        
        loop Background
            L1->>L1: write_body(chunk)
        end
    end
    
    deactivate HitWrapper
    
    Note over Client,L1: Finish phase
    
    Client->>HitWrapper: finish()
    activate HitWrapper
    
    HitWrapper->>Source: finish()
    activate Source
    Source-->>HitWrapper: ok
    deactivate Source
    
    par Finalize promotions
        HitWrapper->>L0: finish()
        L0-->>HitWrapper: ok
    and
        HitWrapper->>L1: drop(tx)
        Note over L1: Close channel<br/>signal EOF to worker
        HitWrapper->>L1: await join_handle
        L1->>L1: finish()
        L1-->>HitWrapper: ok
    end
    
    HitWrapper-->>Client: ok
    deactivate HitWrapper
